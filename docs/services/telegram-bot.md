# Telegram Bot

**URL:** polling mode (no web URL needed)
**Siri API:** `http://siri.homelab`
**Profile:** core (always running)
**Image:** `ghcr.io/standw7/telegram-bot:latest`

## What It Does

A personal AI assistant Telegram bot powered by Claude. Supports web search, task management, calendar, weather, habit tracking, reminders, and Apple Shortcuts integration via a Siri API endpoint.

## Required Environment Variables

| Variable | Description | How to Get |
|----------|-------------|-----------|
| `TELEGRAM_TOKEN` | Bot token | Create a bot via [@BotFather](https://t.me/BotFather) on Telegram |
| `ANTHROPIC_API_KEY` | Claude API key | [Anthropic Console](https://console.anthropic.com/settings/keys) |
| `ALLOWED_CHAT_IDS` | Comma-separated chat IDs | Send a message to your bot, check `docker compose logs telegram-bot` for your chat ID |
| `SIRI_API_KEY` | API key for Apple Shortcuts | Auto-generated by setup script, or `openssl rand -hex 32` |

### Optional Integration Variables

| Variable | Description |
|----------|-------------|
| `BEAVER_HABITS_EMAIL` | Beaver Habits login email |
| `BEAVER_HABITS_PASSWORD` | Beaver Habits login password |
| `GOOGLE_ICAL_URLS` | Pipe-separated Google Calendar iCal URLs |
| `STRAVA_CLIENT_ID` | Strava API Client ID |
| `STRAVA_CLIENT_SECRET` | Strava API Client Secret |
| `STRAVA_REFRESH_TOKEN` | Strava OAuth refresh token |

## First-Time Setup

1. Create a Telegram bot:
   - Open Telegram, search for `@BotFather`
   - Send `/newbot`, follow the prompts
   - Copy the bot token
2. Add token to `.env`: `TELEGRAM_TOKEN=your-token`
3. Add your Anthropic API key to `.env`
4. Start the stack: `docker compose up -d`
5. Send a message to your bot on Telegram
6. Check logs for your chat ID: `docker compose logs telegram-bot`
7. Add your chat ID to `.env`: `ALLOWED_CHAT_IDS=your-chat-id`
8. Restart: `docker compose restart telegram-bot`

## Commands

| Command | Description |
|---------|-------------|
| `/search <query>` | Web search via SearXNG |
| `/url <link>` | Fetch and summarize a webpage |
| `/weather` | Current weather |
| `/location <city>` | Set your location |
| `/news` | Top Hacker News stories |
| `/task <title>` | Create a task in DoIt |
| `/tasks` | List incomplete tasks |
| `/done <#>` | Complete a task |
| `/calendar` | Today's calendar events |
| `/briefing` | Full daily summary |
| `/remind <time> <msg>` | Set a reminder (e.g., `2h`, `30m`) |
| `/remember <note>` | Save a persistent note |
| `/recall` | List saved notes |
| `/clear` | Reset conversation history |

The bot also understands natural language â€” "what's the weather", "add task: buy groceries", etc.

## Siri API

The bot exposes an HTTP API on port 8088 for Apple Shortcuts integration:

```
POST http://siri.homelab/siri
Authorization: Bearer <SIRI_API_KEY>
Content-Type: application/json

{"command": "what's on my calendar today"}
```

## Configuration

**Data:** Chat history, notes, reminders stored in Docker volume `telegram_bot_data`
**Model:** Set `CLAUDE_MODEL` in `.env` (default: `claude-haiku-4-5-20251001`)

## Troubleshooting

**Bot not responding:** Check that `ALLOWED_CHAT_IDS` includes your chat ID. Check logs:
```bash
docker compose logs telegram-bot
```

**Search not working:** SearXNG must be running (enable the `search` profile).
